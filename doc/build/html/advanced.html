<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Advanced Usage &mdash; infraGA/GeoAc  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Visualization" href="plotting.html" />
    <link rel="prev" title="Quickstart" href="quickstart.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> infraGA/GeoAc
            <img src="_static/LANL Logo White.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="userguide.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="authorship.html">Authorship &amp; References</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="atmospheres.html">Atmospheric Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Advanced Usage</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#advanced-parameter-settings">Advanced Parameter Settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="#advanced-option-usage">Advanced Option Usage</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">Visualization</a></li>
<li class="toctree-l1"><a class="reference internal" href="utilities.html">Utility Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="physics.html">Propagation Physics</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">infraGA/GeoAc</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
      <li class="breadcrumb-item active">Advanced Usage</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/advanced.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="advanced-usage">
<span id="advanced"></span><h1>Advanced Usage<a class="headerlink" href="#advanced-usage" title="Permalink to this heading"></a></h1>
<p>In addition to the <code class="code docutils literal notranslate"><span class="pre">prop</span></code> option that simulate propagation from a point source through a specified atmospheric structure.  Additional parameter settings are available to include range dependence and realistic terrain interactions and additional simulation options include methods to compute eigenray paths connecting specific source-receiver geometries as well as compute the weakly non-linear (weak shock limit) waveform evolution along individual ray paths.</p>
<section id="advanced-parameter-settings">
<h2>Advanced Parameter Settings<a class="headerlink" href="#advanced-parameter-settings" title="Permalink to this heading"></a></h2>
<p><strong>Range Dependent Analysis</strong></p>
<p>Using the <code class="code docutils literal notranslate"><span class="pre">--atmo-file</span></code> parameter defines a single atmospheric specification to use for a stratified atmospheric model.  In cases where propagation extends more than a few hundred kilometers, horizontal variations in the atmospheric structure can become significant.  Range dependent atmospheric structure can be used in infraGA/GeoAc via specification of an atmospheric file prefix as well as horizontal grid nodes.  An example 4x4 grid is provided in the examples/profs directory that includes 16 atmospheric files (example0.met, example1.met, example2.met, etc.) along with example_lat.dat and example_lon.dat that contain the latitude and longitude of the grid nodes.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph prop --atmo-prefix profs/example --grid-lats profs/example_lat.dat --grid-lons profs/example_lon.dat --src-lat 40.0 --src-lon -102.5 --azimuth -90.0 --z-grnd 1.0
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ############################################
  ####     Running infraga-sph-rngdep     ####
  ####             Propagation            ####
  ############################################

Interpolating atmosphere data in &#39;profs/example&#39;* using format &#39;zTuvdp&#39;...
  Setting grid node at (35, -110) with profile profs/example0.met
  Setting grid node at (35, -106.67) with profile profs/example1.met
  Setting grid node at (35, -103.33) with profile profs/example2.met
  ...
  Setting grid node at (38.33, -110) with profile profs/example4.met
  Setting grid node at (38.33, -106.67) with profile profs/example5.met
  Setting grid node at (38.33, -103.33) with profile profs/example6.met
  ...
  Setting grid node at (41.66, -110) with profile profs/example8.met
  Setting grid node at (41.66, -106.67) with profile profs/example9.met
  Setting grid node at (41.66, -103.33) with profile profs/example10.met
  ...

  Propagation region limits:
    latitude = 35.001, 44.999
    longitude = -109.999, -100.001
    altitude = 0, 150


Parameter summary:
  inclination: 0.5, 45, 0.5
  azimuth: -90, -90, 1
  bounces: 2
  source location (lat, lon, alt): 40, -102.5, 1
  ground elevation: 1
  frequency: 0.1
  S&amp;B atten coeff: 1
  write_atmo: false
  write_rays: true
  write_topo: false
  write_caustics: false
  calc_amp: true

Calculating ray path: 0.5 degrees inclination, 90 degrees azimuth.
Calculating ray path: 1 degrees inclination, 90 degrees azimuth.
...
Calculating ray path: 44.5 degrees inclination, 90 degrees azimuth.
Calculating ray path: 45 degrees inclination, 90 degrees azimuth.
</pre></div>
</div>
</div></blockquote>
<p>Note that the various atmospheres are read in and set on the grid nodes in a specific order (cycling through longitude values first).  When using a user created grid it’s useful to check that the atmospheric specifications are being ingested and set at the correct nodes.  A utility function is available to build a grid for range dependent analysis in <a class="reference internal" href="utilities.html#utilities"><span class="std std-ref">Utility Functions</span></a>.</p>
<p>Visualization of range-dependent results is relatively straightforward and similar those doing so with stratified results; though, only one of the atmospheric files can be visualized so that the arrivals and ray path files must be specified directly.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot azimuthal --atmo-file profs/example0.met --arrivals profs/example.arrivals.dat --ray-paths profs/example.raypaths.dat
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/rng-dep_azimuthal.png"><img alt="_images/rng-dep_azimuthal.png" class="align-center" src="_images/rng-dep_azimuthal.png" style="width: 1200px;" /></a>
</div></blockquote>
<p>Although the range-dependent effects aren’t overly obvious in this simulation due to the limited propagation range, comparison of the inclination angles and point-to-point propagation of the ray paths does exhibit variations.  Due to the added complexity of multi-variate interpolation needed to compute the gradients of the atmospheric parameters not only in the vertical direction but also in the horizontal, computation of range-dependent ray paths is notably slower than stratified analyses.</p>
<p>For global scale analyses (e.g., analysis of propagation paths from large bolides or volcanic eruptions), one can define a maximum propagation range greater than half of the circumference of the Earth (~24,000 km) so that the great circle distances never reach the break condition and use the <code class="code docutils literal notranslate"><span class="pre">--max-tm</span></code> parameter to define a maximum propagation time (defined in hours): <code class="code docutils literal notranslate"><span class="pre">--max-rng</span> <span class="pre">25000</span> <span class="pre">--max-tm</span> <span class="pre">24.0</span> <span class="pre">--bounces</span> <span class="pre">1000</span></code></p>
<p><strong>Including Realistic Terrain</strong></p>
<p>The simulations run in the <a class="reference internal" href="quickstart.html#quickstart"><span class="std std-ref">Quickstart</span></a> assumed a flat ground that could be modified using <code class="code docutils literal notranslate"><span class="pre">--z-grnd</span></code> to change its elevation; however, infrasonic signals have wavelength that can be comparable in scale to large scale terrain features (e.g., mountain ranges, canyons) so that interaction of energy with realistic terrain is an important factor in propagation simulations.  A terrain file can be specified for use in a simulation using the parameter <code class="code docutils literal notranslate"><span class="pre">--topo-file</span></code> (or <code class="code docutils literal notranslate"><span class="pre">topo_file</span></code> in the C/C++ or config file syntax).  For a spherical geometry simulation, this file should contain the elevation of the ground surface (in kilmoeters relative to sea level) at a series of latitude and longitude points.  One of the included <a class="reference internal" href="utilities.html#utilities"><span class="std std-ref">Utility Functions</span></a> can be used to build a grid file for use:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga utils extract-terrain --geom latlon-grid --lat1 35.0 --lon1 -110.0 --lat2 45.0 --lon2 -100.0 --output-file sph_topo.dat
</pre></div>
</div>
</div></blockquote>
<p>In this function call a latitude/longitude grid is defined with a lower-left corner at (35.0, -110.0) and upper-right corner at (45.0, -100.0).  The terrain is written into a file named <code class="code docutils literal notranslate"><span class="pre">sph_topo.dat</span></code> and a map showing the terrain is printed to screen.  The method will download the <a class="reference external" href="https://www.ngdc.noaa.gov/mgg/global/relief/ETOPO1/data/ice_surface/grid_registered/netcdf/ETOPO1_Ice_g_gmt4.grd.gz">ETOPO1 model file</a> for use and store it within the infraGA/GeoAc directory structure at an expected location for repeated use in subsequent function calls.  The spatial resolution of the output preserves the 1 arc-minute (<span class="math notranslate nohighlight">\(\sim1.85\)</span> km) resolution of the ETOPO1 model.  Also, it should be noted that the elevation scale extends below sea level to show oceanic regions in the visualization; however, the terrain file snaps such locations to sea level as infrasonic waves will reflect from the ocean surface.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/terrain_extraction.png"><img alt="_images/terrain_extraction.png" class="align-center" src="_images/terrain_extraction.png" style="width: 600px;" /></a>
</div></blockquote>
<p>The file created by the utility function contains 3 columns describing latitude, longitude, and ground surface elevation.  The ordering of grid points is such that longitude values are cycled through at each latitude point (note that this is the same convention used in specifying files for the range-dependent grid above).</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>35.00000000000003 -110.0              1.639
35.00000000000003 -109.98333333333333 1.62
35.00000000000003 -109.96666666666667 1.634
...
35.00000000000003 -100.01666666666667 0.607
35.00000000000003 -100.0              0.582
35.016666666666694 -110.0             1.657
35.016666666666694 -109.98333333333333 1.648
35.016666666666694 -109.96666666666667 1.649
...
</pre></div>
</div>
</div></blockquote>
<p>The terrain file can used in a simulation by specifying it as the topography file (<code class="code docutils literal notranslate"><span class="pre">--topo-file</span></code> or <code class="code docutils literal notranslate"><span class="pre">topo_file</span></code>).  It should be noted that given the limited latitude and longitude bounds of the grid, the default source location in the <code class="code docutils literal notranslate"><span class="pre">infraga</span> <span class="pre">sph</span></code> methods may not be valid and the default source location when user input is not provided is defined by the mid-point of the propagation domain.  In the following simulation, a source is defined to the east of the Rocky Mountains in the western US and ray paths are computed for propagation in the westward stratospheric waveguide:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph prop --atmo-file ToyAtmo.met --topo-file sph_topo.dat --src-lat 40.0 --src-lon -102.5 --azimuth -90.0
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ###########################################
  ####        Running infraga-sph        ####
  ####            Propagation            ####
  ###########################################

Interpolating atmosphere data in &#39;ToyAtmo.met&#39; and topography data in &#39;sph_topo.dat&#39;...
  Propagation region limits:
    latitude = 35.001, 44.9823
    longitude = -109.999, -100.001
    altitude = 0, 139.9

  Maximum topography height: 4.106
  Boundary layer height: 6.106

Parameter summary:
  inclination: 0.5, 45, 0.5
  azimuth: -90, -90, 1
  bounces: 10
  source location (lat, lon, alt): 40, -102.5, 1.208
  turn_ht_min: 0.2
  frequency: 0.1
  S&amp;B atten coeff: 1
  write_atmo: false
  write_rays: true
  write_topo: true
  write_caustics: false
  calc_amp: true

Calculating ray path: 0.544095 degrees inclination, -90 degrees azimuth.
Calculating ray path: 1.0441 degrees inclination, -90 degrees azimuth.
Calculating ray path: 1.5441 degrees inclination, -90 degrees azimuth.
...
</pre></div>
</div>
</div></blockquote>
<p>The output is similar to the flat ground simulation; though, the terrain file ingestion is noted and the maximum terrain height and an approximated boundary layer height (2 km above the peak of terrain) is printed to screen for reference.</p>
<p>The ground intercept condition is more numerically intensive when considering terrain because instead of comparing the ray altitude to a constant value the interpolated ground surface must be evaluated at the latitude and longitude of the ray path.  The reason that a 2 km layer is chosen is that the envelope which smoothly forces the wind fields to zero at the ground surface extends some distance above the ground and that envelope also requires evaluation of the terrain interpolation.  This results in longer computation times for tropospheric propagation paths for which the ray path is in this near ground region for a large portion of the simulation, but avoid increasing the computation time for middle- and upper atmospheric portions of the path when terrain isn’t directly impacting the propagation path.</p>
<p>Visualization of the propagation results can be done using the same azimuthal function from the <a class="reference internal" href="quickstart.html#quickstart"><span class="std std-ref">Quickstart</span></a>, <code class="code docutils literal notranslate"><span class="pre">infraga</span> <span class="pre">plot</span> <span class="pre">azimuthal</span> <span class="pre">--atmo-file</span> <span class="pre">ToyAtmo.met</span></code>, and the interaction of terrain is evident in the scatter of reflected arrivals near 350 km downrange that becomes even more severe beyond 500 km.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/terrain_prop1.png"><img alt="_images/terrain_prop1.png" class="align-center" src="_images/terrain_prop1.png" style="width: 1200px;" /></a>
</div></blockquote>
<p>The interaction with terrain can be directly seen by zooming the figure into the near ground as shown below (simply click/drag to highlight the region in the matplotlib window).  The variable altitude and gradients of the terrain are evident in the lower bound of the ray paths.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/terrain_prop2.png"><img alt="_images/terrain_prop2.png" class="align-center" src="_images/terrain_prop2.png" style="width: 1200px;" /></a>
</div></blockquote>
<p>It would be useful to also visualize the terrain along the propagation path; however, this isn’t immediately possible as the terrain file defined the latitude and longitude grid for the entire region.  The parameter <code class="code docutils literal notranslate"><span class="pre">--write-topo</span></code> can be used to output the terrain profile immediately underneath the first ray path.  Though not included in the below example, it is also useful to leverage the OpenMPI methods for this computation because of the increased computation time needed to use the terrain interpolation.  Recalling that the multi-threaded methods automatically turn off ray path output, this requires <code class="code docutils literal notranslate"><span class="pre">--write-rays</span> <span class="pre">True</span> <span class="pre">--cpu-cnt</span> <span class="pre">8</span></code> with the CPU count set to whatever is available on you machine.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph prop --atmo-file ToyAtmo.met --topo-file sph_topo.dat  --azimuth -90.0 --src-lat 40.0 --src-lon -102.5 --write-topo True
</pre></div>
</div>
</div></blockquote>
<p>This simulation produces the familiar raypaths and arrivals files as well as a file named <code class="code docutils literal notranslate"><span class="pre">ToyAtmo.terrain.dat</span></code> that includes the latitude, longitude, and terrain elevation below the first ray path computed.  This terrain profile can be included in the azimuthal visualization to show the terrain along the propagation azimuth,</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot azimuthal --atmo-file ToyAtmo.met --terrain-profile ToyAtmo.terrain.dat
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/terrain_prop3.png"><img alt="_images/terrain_prop3.png" class="align-center" src="_images/terrain_prop3.png" style="width: 1200px;" /></a>
</div></blockquote>
<p>This visualization is notably more clear in showing what the terrain profile looks like along the path.</p>
<p>It should be noted that in some cases cross winds and terrain interactions can lead to ray paths that deviate significantly from the initial azimuthal plane.  In such a case, the terrain profile projected below the first ray path may differ significantly from that below other ray paths and those ray paths may appear to reflect from regions above or below the projected terrain profile.  In such a case, a secondary simulation using a higher inclination initial ray path might be useful to investigate the terrain profile below others in the simulation (be sure to save the arrivals and ray path output before doing this as they will be overwritten in the repeated simulations).</p>
<p><strong>Elevated Sources</strong></p>
<p>The default inclination angle range used in ray tracing assumes a source at the ground surface and a slightly positive inclination minimum.  In the case of an elevated source, this results in a large portion of ray paths being left uncomputed.  Consider running a simulation with a source at an altitude of 20 kilometers:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph prop --atmo-file ToyAtmo.met --src-alt 20.0
</pre></div>
</div>
</div></blockquote>
<p>The resulting ray paths can be visualized to see how a large portion of energy is missing from the simulation output:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot azimuthal --atmo-file ToyAtmo.met
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/elevated_source1.png"><img alt="_images/elevated_source1.png" class="align-center" src="_images/elevated_source1.png" style="width: 900px;" /></a>
</div></blockquote>
<p>The Jacobian computation that is required to solve the Transport equation and calculate the geometric spreading has a singularity for inclination angles of <span class="math notranslate nohighlight">\(\pm 90^o\)</span>; therefore, a minimum inclination angle of <span class="math notranslate nohighlight">\(89^o\)</span> should be used as the lower limit in computing ray paths for an elevated source:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph prop --atmo-file ToyAtmo.met --src-alt 20.0 --incl-min -89.0
</pre></div>
</div>
</div></blockquote>
<p>Visualizing this result shows the additional ray paths which are initially downward propagating and ensonify the region below the source.  Also, the initially upward and downward paths produce alternating ensonification in the stratospheric waveguide:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot azimuthal --atmo-file ToyAtmo.met
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/elevated_source2.png"><img alt="_images/elevated_source2.png" class="align-center" src="_images/elevated_source2.png" style="width: 900px;" /></a>
</div></blockquote>
<p>Reducing the maximum propagation range to 400 km (adding <code class="code docutils literal notranslate"><span class="pre">--max-rng</span> <span class="pre">400</span></code> to the above simulation command) more clearly shows the ensonification below the source and the two sets of ray paths contained within the stratospheric waveguide.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/elevated_source3.png"><img alt="_images/elevated_source3.png" class="align-center" src="_images/elevated_source3.png" style="width: 700px;" /></a>
</div></blockquote>
</section>
<section id="advanced-option-usage">
<h2>Advanced Option Usage<a class="headerlink" href="#advanced-option-usage" title="Permalink to this heading"></a></h2>
<p><strong>Eigenray Analysis</strong></p>
<p>In some scenarios, those specific propagation paths connecting known source and receiver locations are of interest.  Such propagation paths are termed ‘eigenrays’ and can be difficult to compute when considering propagation paths in 3 dimensions including cross winds.  The auxiliary parameters that are utilized by infraGA/GeoAc for computation of the geometric spreading losses can also be leveraged for computation of launch angle changes that shift an arrival closer to a desired location.  A Levenberg-Marquardt (LM) algorithm has been implemented that uses the auxiliary parameters for such a search (more detail in the <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Propagation Physics</span></a> discussion and in Blom &amp; Waxler (2017)).  The eigenray methods in infraGA/GeoAc are accessed using the <code class="code docutils literal notranslate"><span class="pre">eigenray</span></code> flag instead of <code class="code docutils literal notranslate"><span class="pre">prop</span></code> and have a number of common parameters.  In addition to specifying a source location, the receiver location is also needed.  The following command runs an eigenray search for a source at (30, -100) to a receiver to the west-south-west at (30.25, -104.25).</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph eigenray --atmo-file ToyAtmo.met --src-lat 30.0 --src-lon -100.0 --rcvr-lat 30.25 --rcvr-lon -104.25 --bnc-max 1 --verbose True
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ###########################################
  ####        Running infraga-sph        ####
  ####          Eigenray Search          ####
  ###########################################

Interpolating atmosphere data in &#39;ToyAtmo.met&#39; using format &#39;zTuvdp&#39;...
  Propagation region limits:
    latitude = -90, 90
    longitude = -180, 180
    altitude = 0, 139.9


Parameter summary:
  source location (lat, lon, alt): 30, -100, 0
  receiver location (lat, lon, alt): 30.25, -104.25, 0
  inclination range: 0.5, 45
  bounces: 0, 1
  ground elevation: 0
  damping:0.001
  frequency: 0.1
  S&amp;B atten coeff: 1
  verbose: true

Searching for 0 bounce eigenrays.
  Estimating eigenray angles for source-receiver at great circle distance 409.604 km and azimuth -85.0442 degrees from N.  Inclination limits: [0.5, 45].
    Ray launched with inclination 0.5, azimuth -85.0442 arrives at range 216.761 km after 0 bounce(s).      Exact arrival at 30.1468 degrees N latitude, -102.247 degrees E longitude
    Ray launched with inclination 0.6, azimuth -85.0442 arrives at range 216.445 km after 0 bounce(s).      Exact arrival at 30.1466 degrees N latitude, -102.243 degrees E longitude
    ...
    Ray launched with inclination 35.8, azimuth -85.0442 arrives at range 410.169 km after 0 bounce(s).     Exact arrival at 30.24 degrees N latitude, -104.256 degrees E longitude
    Ray launched with inclination 35.9, azimuth -85.0442 arrives at range 408.259 km after 0 bounce(s).     Exact arrival at 30.239 degrees N latitude, -104.237 degrees E longitude
    Azimuth deviation = 0.163077, less than 2 degrees: estimates acceptable.

    Searching for exact eigenray using auxiliary parameters.
    Calculating ray path: 35.8 degrees inclination, -85.0442 degrees azimuth                Arrival at (30.240036, -104.25644), distance to receiver = 1.2688308 km.
    Calculating ray path: 35.831669 degrees inclination, -84.874356 degrees azimuth         Arrival at (30.249983, -104.24998), distance to receiver = 0.002455279 km.
    Eigenray-0:
      inclination [deg] = 35.831669
      azimuth [deg] = -84.874356
      bounces [-] = 0
      latitude [deg] = 30.249983
      longitude [deg] = -104.24998
      time [s] = 1503.657
      celerity [km/s] = 0.27240416
      turning height [km] = 130.22471
      arrival inclination [deg] = 35.84037
      back azimuth [deg] = 92.992416
      attenuation (geometric) [dB] = -54.837386
      absorption [dB] = -23.705732

    Estimating eigenray angles for source-receiver at great circle distance 409.60414 km and azimuth -85.044241 degrees from N.  Inclination limits: [35.9, 45].
    Ray launched with inclination 35.9, azimuth -85.0442 arrives at range 408.259 km after 0 bounce(s).     Exact arrival at 30.239 degrees N latitude, -104.237 degrees E longitude
    ...
    Ray launched with inclination 44.9, azimuth -85.044241 arrives at range 314.57557 km after 0 bounce(s). Exact arrival at 30.169893 degrees N latitude, -103.26423 degrees E longitude
    Reached maximum inclination angle or iteration limit.

Searching for 1 bounce eigenrays.
  Estimating eigenray angles for source-receiver at great circle distance 409.60414 km and azimuth -85.044241 degrees from N.  Inclination limits: [0.5, 45].
    Ray launched with inclination 0.5, azimuth -85.044241 arrives at range 433.04978 km after 1 bounce(s).  Exact arrival at 30.255722 degrees N latitude, -104.49409 degrees E longitude
    Ray launched with inclination 0.6, azimuth -85.044241 arrives at range 432.46918 km after 1 bounce(s).  Exact arrival at 30.255473 degrees N latitude, -104.48806 degrees E longitude
    ...

Identified 3 eigenray(s).
</pre></div>
</div>
</div></blockquote>
<p>As with the <code class="code docutils literal notranslate"><span class="pre">prop</span></code> simulations, atmospheric data is ingested and interpolated to define the propagation medium and the parameter summary provides an overview of the run settings.</p>
<p>The methodology of infraGA/GeoAc’s eigenray search is separated into two stages: In the initial stage, rays are launched in the direction from the source to the receiver at increasing inclination angles.  Once a pair of rays are identified which pass over the receiver range, the LM algorithm is used to search for the exact eigenray.  The search is the resumed from the launch angle that triggered the LM search and these steps are repeated until the maximum inclination angle is reached.  The search then begins with an increased number of ground reflections and continues until the maximum number of such reflections is reached.  Upon completion, the various eigenray paths are written into unique files (e.g., ‘ToyAtmo.eigenray-0.dat’) and all eigenray arrivals are written into an arrivals file.</p>
<p>In the above simulation, the <code class="code docutils literal notranslate"><span class="pre">--verbose</span></code> parameter is set to True and additional information is printed to screen as the eigenray search stages are completed.  If this parameter is set to <code class="code docutils literal notranslate"><span class="pre">false</span></code>, then less information is printed to screen as the simulation is run:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ###########################################
  ####        Running infraga-sph        ####
  ####          Eigenray Search          ####
  ###########################################

Interpolating atmosphere data in &#39;ToyAtmo.met&#39; using format &#39;zTuvdp&#39;...
  Propagation region limits:
    latitude = -90, 90
    longitude = -180, 180
    altitude = 0, 139.9


Parameter summary:
  source location (lat, lon, alt): 30, -100, 0
  receiver location (lat, lon, alt): 30.25, -104.25, 0
  inclination range: 0.5, 45
  bounces: 0, 1
  ground elevation: 0
  damping:0.001
  frequency: 0.1
  S&amp;B atten coeff: 1
  verbose: false

Searching for 0 bounce eigenrays.
  Eigenray identified:      theta, phi = 35.831669, -84.874356 degrees.
Searching for 1 bounce eigenrays.
  Eigenray identified:      theta, phi = 4.1392114, -84.970504 degrees.
  Eigenray identified:      theta, phi = 31.703267, -84.583914 degrees.
Identified 3 eigenray(s).
</pre></div>
</div>
</div></blockquote>
<p>The verbose option is fairly useful when the user is unsure of what eigenrays are expected or the method is not identify an expected eigenray.  Several other parameters have unique functionality in eigenray searches:</p>
<blockquote>
<div><p><em>Reflection count</em>: the parameters <code class="code docutils literal notranslate"><span class="pre">--bnc-min</span></code> <code class="code docutils literal notranslate"><span class="pre">--bnc-max</span></code>, and <code class="code docutils literal notranslate"><span class="pre">--bounces</span></code> allow the user to define the range possible ground reflections to consider or a single number of reflections.  For tropospheric paths at notable distance, it might be useful to start the eigenray search at a larger number of reflections and separate search runs are useful for identifying middle- and upper atmospheric returns that might have just a few reflections and tropospheric paths that might require more (e.g., stratospheric returns with 1 or 2 reflections and tropospheric paths with 10 - 15 reflections).</p>
<p><em>Search parameters</em>: the initial search for eigenrays uses an adustable inclination step that can be controlled using <code class="code docutils literal notranslate"><span class="pre">--incl-step-min</span></code> and <code class="code docutils literal notranslate"><span class="pre">--incl-step-max</span></code> (defaults 0.001 and 0.1 degrees).  Once an estimated eigenray is identified, the azimuth deviation due to cross winds is checked against the <code class="code docutils literal notranslate"><span class="pre">--az-dev-lim</span></code> value to ensure the LM search will be well posed and stable  (defaults to 2 degrees).</p>
<p><em>LM parameters</em>: the Levenberg-Marquardt algorithm uses a damping coefficient to stabilize the search which can be modified using <code class="code docutils literal notranslate"><span class="pre">--damping</span></code> (<span class="math notranslate nohighlight">\(\lambda\)</span> in the discussion of <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Propagation Physics</span></a>).  A tolerance for accepting an eigenray can be accessed through <code class="code docutils literal notranslate"><span class="pre">--tolerance</span></code>, which has a default value of 0.1 km (smaller than the typical infrasonic array aperture).</p>
</div></blockquote>
<p>Eigenray results can be visualized using <code class="code docutils literal notranslate"><span class="pre">infraga</span> <span class="pre">plot</span> <span class="pre">eigenray</span> <span class="pre">--atmo-file</span> <span class="pre">ToyAtmo.met</span></code> and show the along-azimuth effective sound speed profile for reference, all identified eigenray paths, and some characteristic (default is launch inclination vs. travel time).  As seen below, the color of the ray path corresponds to the arrival characteristics so the individual paths can be compared.  In this case, a direct thermospheric path (blue) is identified with later arrival time than the pair of single-reflection stratospheric arrivals (orange, green).</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eigenray1.png"><img alt="_images/eigenray1.png" class="align-center" src="_images/eigenray1.png" style="width: 1200px;" /></a>
</div></blockquote>
<p>The <code class="code docutils literal notranslate"><span class="pre">--y-axis-option</span></code> parameter included in the azimuthal visualizations is available in this method as well.  Running the above visualization and adding <code class="code docutils literal notranslate"><span class="pre">--y-axis-option</span> <span class="pre">amplitude</span></code> produces the below result so one can see how the largest amplitude amplitude is the shallower angle stratospheric arrival (often termed the ‘slow stratospheric phase’ per Waxler et al. (2015)).  The earlier, steeper inclination angle stratospheric phase (often termed the ‘fast stratospheric phase’) is markedly lower amplitude, and the thermospheric phase arriving later is even more attenuated due to combination of geometric and thermo-viscous losses.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eigenray2.png"><img alt="_images/eigenray2.png" class="align-center" src="_images/eigenray2.png" style="width: 1200px;" /></a>
</div></blockquote>
<p><strong>Waveform Calculations</strong></p>
<p>Waveform evolution along individual ray paths can be computed in the weakly non-linear (also termed the weak shock limit) using a Burgers equation method (summarized in the discussion of <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Propagation Physics</span></a> and in Lonzaga et al. (2015) and Blom &amp; Waxler (2021)) through the <code class="code docutils literal notranslate"><span class="pre">wnl-wvfrm</span></code> option.  Such analysis requires a known waveform at some location, <span class="math notranslate nohighlight">\(s_1\)</span>, along the ray path and computes the evolved waveform at some later location, <span class="math notranslate nohighlight">\(s_2\)</span> further along the path.  Because such analysis focuses on the waveform evolution along a single ray path, a single inclination and azimuth angle combination are needed to identify the ray path of interest.</p>
<p>Several waveform options are included in infraGA/GeoAc including a blastwave/impulse (originally from Freidlander (1946) and generalized by Waxler et al. (2018), see <a class="reference internal" href="physics.html#physics"><span class="std std-ref">Propagation Physics</span></a> discussion for details) and an “N-wave” typical of sonic booms.  Alternatively, one can specify a file containing an overpressure time series recorded at some location and use that to initialize the waveform evolution methods.  Lastly, though not included in the C/C++ interface, the Python CLI includes an option to specify an explosive yield in equivalent kg of TNT for which the Kinney &amp; Graham (1985) scaling laws are used to initialize a blastwave.</p>
<p>Using the slow stratospheric phase in the above eigenray examples (theta, phi = 4.1392114, -84.970504 degrees; 1 ground reflection) and considering a 10 ton (10e3 kg) eq. TNT source,</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph wnl-wvfrm --atmo-file ToyAtmo.met --src-lat 30.0 --src-lon -100.0 --bounces 1 --inclination 4.1392114 --azimuth -84.970504 --wvfrm-yield 10e3
</pre></div>
</div>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>  ###########################################
  ####        Running infraga-sph        ####
  ####     Weakly Non-Linear Waveform    ####
  ###########################################

Interpolating atmosphere data in &#39;ToyAtmo.met&#39; using format &#39;zTuvdp&#39;...
  Propagation region limits:
    latitude = -90, 90
    longitude = -180, 180
    altitude = 0, 139.9


Parameter summary:
  inclination: 4.13921
  azimuth: -84.9705
  bounces: 1
  source location (lat, lon, alt): 30, -100, 0
  ground elevation: 0
  frequency: 0.1
  S&amp;B atten coeff: 1
  waveform option: impulse
  waveform p0: 2432.82
  waveform t0: 0.0890579
  waveform alpha: 0.01
  waveform reference location: 0.754052

Calculating ray path geometry and weakly non-linear waveform evolution...
  Defining waveform from built in impulse with shaping parameter = 0.01.
  Generating waveform at ray length: 0      altitude: 0.0579589     scaled non-linearity factor: 0.0458741
  Generating waveform at ray length: 10     altitude: 1.32843       scaled non-linearity factor: 0.00360202
  ...
  Generating waveform at ray length: 110    altitude: 37.596        scaled non-linearity factor: 0.026272
  Caustic encountered.
  Generating waveform at ray length: 120    altitude: 36.9643       scaled non-linearity factor: 0.0178894
  ...
  Generating waveform at ray length: 440    altitude: 0.347231      scaled non-linearity factor: 0.000299998

  Arrival summary:
    latitude [deg] = 30.249997
    longitude [deg] = -104.25002
    time [s] = 1412.4271
    celerity [km/s] = 0.29000158
    turning height [km] = 37.596484
    arrival inclination [deg] = 4.1765906
    back azimuth [deg] = 92.895927
    trans. coeff. [dB] = -40.225568
    absorption [dB] = -0.14986747
</pre></div>
</div>
</div></blockquote>
<p>The peak overpressure and positive phase duration are defined from Kinney &amp; Graham (1985) scaling laws computed internally at a reference distance defined by 35 <span class="math notranslate nohighlight">\(\frac{\text{m}}{\text{kg}^3}\)</span> (this is the distance at which the shock velocity slows to within 1% of the sound speed and propagation becomes essentially linear/elastic).  Also, the ambient pressure and temperature are estimated from the sound speed and density so that explosive sources aloft can be specified.  The waveform evolution is computed along the ray path and any caustic encounters are noted and the expected phase shift applied.  The analysis returns an initial waveform file (‘ToyAtmo.wvfrm_init.dat’) that includes the near-source blastwave and the arrival waveform file (‘ToyAtmo.wvfrm_out.dat’).</p>
<p>Currently there are no built-in visualization methods for individual waveform predictions.</p>
<p><strong>Combined Eigenray + Waveform Methods</strong></p>
<p>The C/C++ methods in infraGA/GeoAc for computing eigenrays and the weakly non-linear waveform methods are separated, but have been wrapped into a common Python method that identifies eigenrays connecting a specified source-receiver pair, checks for duplicate eigenray solutions (these can occur when ray paths are near critical launch angles that transition between waveguides), computes waveform predictions for each eigenray, and returns a merged set of results.  The parameter sets used for the eigenray and weakly non-linear waveform analyses are all available in this combined method along with a few additional parameters.  Waveform predictions for the above eigenray analysis can be completed by running,</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph eig_wvfrm --atmo-file ToyAtmo.met --src-lat 30.0 --src-lon -100.0 --rcvr-lat 30.25 --rcvr-lon -104.25 --bnc-max 1 --keep-eig-results True --wvfrm-yield 10e3
</pre></div>
</div>
</div></blockquote>
<p>The <code class="code docutils literal notranslate"><span class="pre">eig_wvfrm</span></code> methods run the eigenray and weakly non-linear methods and merge results into a pair of results files: ‘ToyAtmo.eigenrays.dat’ and ‘ToyAtmo.wvfrms.dat’.  The eigenrays file includes the combined set of all identified ray paths.  The waveforms file has a variable number of columns containing the time (relative to the reference waveform) and a column containing the waveform contribution for each eigenray.  The header of the waveform results file includes much of the information from the simulation as well as the eigenray arrival information and the ordering of the arrival information matches that of the waveform contributions.</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span># &#39;infraga sph eig_wvfrm&#39; waveform results
#
#   profile: ToyAtmo.met
#   source location (lat, lon, alt): 30.0, -100.0, 0.0
#   receiver location (lat, lon, alt): 30.25, -104.25, 0.0
#   inclination range: 0.5, 45.0
#   inclination step max: 0.1
#   bounces: 0, 1
#   ground elevation: 0.0
#   damping: 0.001
#   range max: 2500.0
#
#    waveform reference distance: 0.7540521415111592
#    waveform length: 0.05 None
#    waveform source yield: 10e3
#
# Eigenray arrivals:
# incl [deg]        az [deg]        n_b     lat_0 [deg]     lon_0 [deg]     time [s]        cel [km/s]      turning ht [km] inclination [deg]       back azimuth [deg]      trans. coeff. [dB]      absorption [dB]
# 35.831669 -84.874356 0.0 30.249983 -104.24998 1503.657 0.27240416 130.22471 35.84037 92.992416 -54.837386 -23.705732
# 4.1392114 -84.970504 1.0 30.249997 -104.25002 1412.4271 0.29000158 37.596484 4.1765906 92.895927 -40.225568 -0.14986747
# 31.703267 -84.583914 1.0 30.249995 -104.24994 1392.5105 0.29414393 48.989872 31.730785 93.283741 -59.050528 -0.29681437

# t [s]     p1 [Pa]         p2 [Pa] ...
1334.9252   0.0     0.0     0.0
1334.9392   0.0     0.0     1.5782544e-12
1334.9532000000002  0.0     0.0     6.223907061041175e-12
...
</pre></div>
</div>
</div></blockquote>
<p>The <code class="code docutils literal notranslate"><span class="pre">--keep-eig-results</span></code> option preserves the individual eigenray path files from the eigenray stage (useful if you want to run the eigenray visualization to see each arrival’s characteristics) as well as the arrivals file itself.  It should be noted that keeping the arrivals file enables rapid calculation of new waveform predictions if the source is modified.  That is, if the above simulation has been run and one wants to see how the results change for a 100 ton eq. TNT source, one can simply modify the <code class="code docutils literal notranslate"><span class="pre">--wvfrm-yield</span></code> parameter and the Python methods will check whether eigenray results are already present and skip that portion of the analysis if results are found.</p>
<p>The combined eigenray and waveform predictions can be visualized using similar syntax to the azimuthal and eigenray visualizations <code class="code docutils literal notranslate"><span class="pre">infraga</span> <span class="pre">plot</span> <span class="pre">eig_wvfrms</span> <span class="pre">--atmo-file</span> <span class="pre">ToyAtmo.met</span></code>,</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eig_wvfrm1.png"><img alt="_images/eig_wvfrm1.png" class="align-center" src="_images/eig_wvfrm1.png" style="width: 600px;" /></a>
</div></blockquote>
<p>The resulting figures shows the eigenray paths, predicted overpressure waveform, and arrival characteristics using a matching travel time axis.  In this example, the stratospheric pair is easily identified in the early potion of the waveform and can be seen more clearly by zooming (again, click/drag the matplotlib window) as shown below.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eig_wvfrm2.png"><img alt="_images/eig_wvfrm2.png" class="align-center" src="_images/eig_wvfrm2.png" style="width: 600px;" /></a>
</div></blockquote>
<p>The later arrival from the upper atmosphere can also be more clearly visualized using the interactive matplotlib window as shown below.  In this case the relatively low amplitude of the source and the high turning height of the propagation path results in an overly small amplitude for this waveform contribution.</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/eig_wvfrm3.png"><img alt="_images/eig_wvfrm3.png" class="align-center" src="_images/eig_wvfrm3.png" style="width: 600px;" /></a>
</div></blockquote>
<p>Lastly, similar to the azimuthal and eigenray visualization methods, the lower panel can be modified by specifying the y-axis and colormap variables.  Visualization of the trace velocity and amplitude information can be achieved as,</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot eig_wvfrms --atmo-file ToyAtmo.met --y-axis-option trace-velocity --cmap-option amplitude
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/eig_wvfrm4.png"><img alt="_images/eig_wvfrm4.png" class="align-center" src="_images/eig_wvfrm4.png" style="width: 800px;" /></a>
</div></blockquote>
<p><strong>Supersonic Sources</strong></p>
<p>The set of ray paths emitted by a supersonic source as defined by the geometry of the Mach cone can be computed as discussed in Blom et al. (2024).  The Mach cone ray paths are computed for a single source location by specifying a source location, orientation (attack and azimuth angles), and Mach number (velocity relative to the ambient sound speed).  Usage of this method for a single point source can be run using the below syntax:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga-sph -mach_cone G2S_example.met output_id=temp/t0_110.0 src_mach=2.63 src_attack=-13.12 src_az=90.45 cone_resol=1.0
</pre></div>
</div>
</div></blockquote>
<p>In practice, computation of the infrasonic signals produced by a supersonic source’s Mach cone requires computation of the above set of Mach cone rays at each point along a trajectory and then combination of all predicted paths with appropriate time delay.  The python interface for <em>infraGA/GeoAc</em> includes a method that will ingest atmospheric data as well as a trajectory file (containing time, latitude, longitude, and altitude).  The method computes the Mach number and source orientation information from the trajectory and steps through all points on the trajectory.  Running the prediction of rays for a supersonic source requires an atmospheric file (or range dependent grid) and a trajectory file containing [time:lat:lon:alt]:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga sph supersonic --atmo-file G2S_example.met --trajectory trajectories/ballistic_traj.dat --traj-step 6 --cpu-cnt 12 --output-id ballistic --local-temp-dir ballistic_temp
</pre></div>
</div>
</div></blockquote>
<p>The <code class="code docutils literal notranslate"><span class="pre">--traj-step</span></code> allows one to skip through high resolution trajectory information (the step is that used in <em>numpy</em> indexing notation, <code class="code docutils literal notranslate"><span class="pre">traj_data[::k]</span></code>).  The <code class="code docutils literal notranslate"><span class="pre">--local-temp-dir</span></code> path can be used to keep the predicted ray path data for individual trajectory points.  If a local temporary data directory is not specified, one is created via the <code class="code docutils literal notranslate"><span class="pre">tempfile</span></code> package and removed when the simulation is compelted. By default, only arrival information is stored when running the method unless the <code class="code docutils literal notranslate"><span class="pre">--write-rays</span></code> option is turned on.  While ray paths are being computed, the trajectory information is displayed in a window with points showing where along the trajectory the current computations is located:</p>
<blockquote>
<div><a class="reference internal image-reference" href="_images/supersonic_trajectory.png"><img alt="_images/supersonic_trajectory.png" class="align-center" src="_images/supersonic_trajectory.png" style="width: 800px;" /></a>
</div></blockquote>
<p>Once the computation is complete, the arrival information can be visualized as with other ray tracing simulations:</p>
<blockquote>
<div><div class="highlight-none notranslate"><div class="highlight"><pre><span></span>infraga plot map --arrivals ballistic.arrivals.dat
</pre></div>
</div>
<a class="reference internal image-reference" href="_images/ballistic_arrivals.png"><img alt="_images/ballistic_arrivals.png" class="align-center" src="_images/ballistic_arrivals.png" style="width: 600px;" /></a>
</div></blockquote>
<p>More information about simulating infrasound from supersonic sources can be found in Blom et al. (2024) and citations therein.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="quickstart.html" class="btn btn-neutral float-left" title="Quickstart" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="plotting.html" class="btn btn-neutral float-right" title="Visualization" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2014, P.Blom.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>